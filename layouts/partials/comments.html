{{ if .Site.Params.utterances.enable }}
{{ $repo := .Site.Params.utterances.repo }}
{{ $theme := .Site.Params.utterances.theme | default "github-light" }}
{{ $issueTerm := .Site.Params.utterances.issueTerm | default "pathname" }}

<div class="utterances-wrapper">
    <h3>ğŸ’¬ è¯„è®º</h3>
    
    <!-- ä½¿ç”¨ iframe ç»•è¿‡ CSP é™åˆ¶ -->
    <iframe 
        id="utterances-iframe"
        src="about:blank"
        style="width:100%; height:600px; border:none; overflow:hidden;"
        title="GitHub Issues Comments"
        loading="lazy"
        sandbox="allow-scripts allow-same-origin allow-popups"
    ></iframe>
    
    <script>
    (function() {
        // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
        window.addEventListener('load', function() {
            const iframe = document.getElementById('utterances-iframe');
            if (!iframe) return;
            
            // æ„å»º Utterances URL
            const currentPath = window.location.pathname;
            const utterancesUrl = `https://utteranc.es/?repo={{ $repo }}&issue-term={{ $issueTerm }}&theme={{ $theme }}&url=${encodeURIComponent(window.location.href)}&pathname=${encodeURIComponent(currentPath)}`;
            
            // è®¾ç½® iframe çš„ src
            iframe.src = utterancesUrl;
            
            console.log('Utterances iframe URL:', utterancesUrl);
        });
    })();
    </script>
</div>

<style>
.utterances-wrapper {
    margin: 2rem 0;
    padding-top: 1rem;
    border-top: 1px solid #eee;
}

.utterances-wrapper h3 {
    margin-bottom: 1rem;
    color: #333;
}
</style>
{{ end }}